{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _objectSpread from \"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpRequest, HttpResponse } from \"@aws-sdk/protocol-http\";\nimport { getSkewCorrectedDate } from \"./utils/getSkewCorrectedDate\";\nimport { getUpdatedSystemClockOffset } from \"./utils/getUpdatedSystemClockOffset\";\nexport var awsAuthMiddleware = function awsAuthMiddleware(options) {\n  return function (next, context) {\n    return /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(args) {\n        var _context$endpointV, _context$endpointV$pr, _context$endpointV$pr2, _authScheme$signingRe;\n        var authScheme, multiRegionOverride, signer, output, dateHeader;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (HttpRequest.isInstance(args.request)) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\", next(args));\n            case 2:\n              authScheme = (_context$endpointV = context.endpointV2) === null || _context$endpointV === void 0 ? void 0 : (_context$endpointV$pr = _context$endpointV.properties) === null || _context$endpointV$pr === void 0 ? void 0 : (_context$endpointV$pr2 = _context$endpointV$pr.authSchemes) === null || _context$endpointV$pr2 === void 0 ? void 0 : _context$endpointV$pr2[0];\n              multiRegionOverride = (authScheme === null || authScheme === void 0 ? void 0 : authScheme.name) === \"sigv4a\" ? authScheme === null || authScheme === void 0 ? void 0 : (_authScheme$signingRe = authScheme.signingRegionSet) === null || _authScheme$signingRe === void 0 ? void 0 : _authScheme$signingRe.join(\",\") : undefined;\n              _context.next = 6;\n              return options.signer(authScheme);\n            case 6:\n              signer = _context.sent;\n              _context.t0 = next;\n              _context.t1 = _objectSpread;\n              _context.t2 = _objectSpread({}, args);\n              _context.t3 = {};\n              _context.next = 13;\n              return signer.sign(args.request, {\n                signingDate: getSkewCorrectedDate(options.systemClockOffset),\n                signingRegion: multiRegionOverride || context[\"signing_region\"],\n                signingService: context[\"signing_service\"]\n              });\n            case 13:\n              _context.t4 = _context.sent;\n              _context.t5 = {\n                request: _context.t4\n              };\n              _context.t6 = (0, _context.t1)(_context.t2, _context.t3, _context.t5);\n              _context.next = 18;\n              return (0, _context.t0)(_context.t6).catch(function (error) {\n                var _error$ServerTime;\n                var serverTime = (_error$ServerTime = error.ServerTime) !== null && _error$ServerTime !== void 0 ? _error$ServerTime : getDateHeader(error.$response);\n                if (serverTime) {\n                  options.systemClockOffset = getUpdatedSystemClockOffset(serverTime, options.systemClockOffset);\n                }\n                throw error;\n              });\n            case 18:\n              output = _context.sent;\n              dateHeader = getDateHeader(output.response);\n              if (dateHeader) {\n                options.systemClockOffset = getUpdatedSystemClockOffset(dateHeader, options.systemClockOffset);\n              }\n              return _context.abrupt(\"return\", output);\n            case 22:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  };\n};\nvar getDateHeader = function getDateHeader(response) {\n  var _response$headers$dat, _response$headers, _response$headers2;\n  return HttpResponse.isInstance(response) ? (_response$headers$dat = (_response$headers = response.headers) === null || _response$headers === void 0 ? void 0 : _response$headers.date) !== null && _response$headers$dat !== void 0 ? _response$headers$dat : (_response$headers2 = response.headers) === null || _response$headers2 === void 0 ? void 0 : _response$headers2.Date : undefined;\n};\nexport var awsAuthMiddlewareOptions = {\n  name: \"awsAuthMiddleware\",\n  tags: [\"SIGNATURE\", \"AWSAUTH\"],\n  relation: \"after\",\n  toMiddleware: \"retryMiddleware\",\n  override: true\n};\nexport var getAwsAuthPlugin = function getAwsAuthPlugin(options) {\n  return {\n    applyToStack: function applyToStack(clientStack) {\n      clientStack.addRelativeTo(awsAuthMiddleware(options), awsAuthMiddlewareOptions);\n    }\n  };\n};\nexport var getSigV4AuthPlugin = getAwsAuthPlugin;","map":{"version":3,"names":["HttpRequest","HttpResponse","getSkewCorrectedDate","getUpdatedSystemClockOffset","awsAuthMiddleware","options","next","context","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","args","_context$endpointV","_context$endpointV$pr","_context$endpointV$pr2","_authScheme$signingRe","authScheme","multiRegionOverride","signer","output","dateHeader","wrap","_callee$","_context","prev","isInstance","request","abrupt","endpointV2","properties","authSchemes","name","signingRegionSet","join","undefined","sent","t0","t1","_objectSpread","t2","t3","sign","signingDate","systemClockOffset","signingRegion","signingService","t4","t5","t6","catch","error","_error$ServerTime","serverTime","ServerTime","getDateHeader","$response","response","stop","_x","apply","arguments","_response$headers$dat","_response$headers","_response$headers2","headers","date","Date","awsAuthMiddlewareOptions","tags","relation","toMiddleware","override","getAwsAuthPlugin","applyToStack","clientStack","addRelativeTo","getSigV4AuthPlugin"],"sources":["/Users/ericli/Desktop/pill2/node_modules/@aws-sdk/client-s3/node_modules/@aws-sdk/middleware-signing/dist-es/middleware.js"],"sourcesContent":["import { HttpRequest, HttpResponse } from \"@aws-sdk/protocol-http\";\nimport { getSkewCorrectedDate } from \"./utils/getSkewCorrectedDate\";\nimport { getUpdatedSystemClockOffset } from \"./utils/getUpdatedSystemClockOffset\";\nexport const awsAuthMiddleware = (options) => (next, context) => async function (args) {\n    if (!HttpRequest.isInstance(args.request))\n        return next(args);\n    const authScheme = context.endpointV2?.properties?.authSchemes?.[0];\n    const multiRegionOverride = authScheme?.name === \"sigv4a\" ? authScheme?.signingRegionSet?.join(\",\") : undefined;\n    const signer = await options.signer(authScheme);\n    const output = await next({\n        ...args,\n        request: await signer.sign(args.request, {\n            signingDate: getSkewCorrectedDate(options.systemClockOffset),\n            signingRegion: multiRegionOverride || context[\"signing_region\"],\n            signingService: context[\"signing_service\"],\n        }),\n    }).catch((error) => {\n        const serverTime = error.ServerTime ?? getDateHeader(error.$response);\n        if (serverTime) {\n            options.systemClockOffset = getUpdatedSystemClockOffset(serverTime, options.systemClockOffset);\n        }\n        throw error;\n    });\n    const dateHeader = getDateHeader(output.response);\n    if (dateHeader) {\n        options.systemClockOffset = getUpdatedSystemClockOffset(dateHeader, options.systemClockOffset);\n    }\n    return output;\n};\nconst getDateHeader = (response) => HttpResponse.isInstance(response) ? response.headers?.date ?? response.headers?.Date : undefined;\nexport const awsAuthMiddlewareOptions = {\n    name: \"awsAuthMiddleware\",\n    tags: [\"SIGNATURE\", \"AWSAUTH\"],\n    relation: \"after\",\n    toMiddleware: \"retryMiddleware\",\n    override: true,\n};\nexport const getAwsAuthPlugin = (options) => ({\n    applyToStack: (clientStack) => {\n        clientStack.addRelativeTo(awsAuthMiddleware(options), awsAuthMiddlewareOptions);\n    },\n});\nexport const getSigV4AuthPlugin = getAwsAuthPlugin;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}