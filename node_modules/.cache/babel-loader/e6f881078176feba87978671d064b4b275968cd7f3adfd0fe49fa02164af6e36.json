{"ast":null,"code":"import _slicedToArray from\"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useContext}from\"react\";import{useNavigate}from\"react-router-dom\";import{AccountContext}from\"./User_Account.jsx\";import{Auth}from\"aws-amplify\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var User_login=function User_login(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var navigate=useNavigate();var _useContext=useContext(AccountContext),authenticate=_useContext.authenticate,setAuthenticated=_useContext.setAuthenticated;useEffect(function(){window.fbAsyncInit=function(){window.FB.init({appId:\"730655258288890\",cookie:true,xfbml:true,version:\"v15.0\"});window.FB.AppEvents.logPageView();window.FB.getLoginStatus(function(response){statusChangeCallback(response);});};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src=\"https://connect.facebook.net/en_US/sdk.js\";fjs.parentNode.insertBefore(js,fjs);})(document,\"script\",\"facebook-jssdk\");},[]);var getUserInfo=function getUserInfo(){console.log(\"Getting user info\");window.FB.api(\"/me\",{fields:\"name,email\",appsecret_proof:process.env.PASS_PHRASE},function(response){console.log(\"User info response:\",response);// Added logging here\nconsole.log(\"Successful login for: \"+response.name);var authResponse=window.FB.getAuthResponse();var accessToken=authResponse.accessToken,expiresIn=authResponse.expiresIn;if(!accessToken||!expiresIn){console.log(\"Access token or expiration time is missing.\");return;}console.log(\"Facebook Access Token: \",accessToken);var email=response.email,first_name=response.first_name,last_name=response.last_name,gender=response.gender;window.FB.api(\"/oauth/access_token\",{client_id:\"730655258288890\",client_secret:process.env.FACEBOOK_APP_SECRET,grant_type:\"fb_exchange_token\",fb_exchange_token:accessToken},function(res){if(!res||res.error){console.log(\"Failed to extend access token lifespan: \",res.error);}else{accessToken=res.access_token;expiresIn=60*60*24*60;var currentTimestamp=Date.now();var computedExpiresAt=expiresIn*1000+currentTimestamp;if(!accessToken||!computedExpiresAt){console.log(\"Access token or computed expires time is missing.\");return;}Auth.federatedSignIn(\"facebook\",{token:accessToken,expires_at:computedExpiresAt},{given_name:first_name,family_name:last_name,email:email,gender:gender,picture:\"\",email_verified:true}).then(function(data){console.log(\"Successful federated sign-in:\",data);setAuthenticated(true);navigate(\"/User_dashboard\");}).catch(function(err){console.log(\"Failed to login\",err||\"No error message provided\");});}});});};var statusChangeCallback=function statusChangeCallback(response){console.log(\"Status Change Callback Response:\",response);// Added logging here\nif(response.status===\"connected\"){getUserInfo();}else{console.log(\"User cancelled login or did not fully authorize.\");}};var checkLoginState=function checkLoginState(){console.log(\"Checking login state\");// Added logging here\nwindow.FB.getLoginStatus(function(response){console.log(\"Got login status response\",response);// Added logging here\nstatusChangeCallback(response);});};var onSubmit=function onSubmit(event){event.preventDefault();authenticate(email,password).then(function(data){setAuthenticated(true);navigate(\"/User_dashboard\");}).catch(function(err){console.log(\"Failed to login\",err||\"No error message provided 1\");});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{value:email,onChange:function onChange(event){return setEmail(event.target.value);}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{value:password,onChange:function onChange(event){return setPassword(event.target.value);}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Login\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:checkLoginState,children:\" Hi \"})]});};export default User_login;","map":{"version":3,"names":["React","useState","useEffect","useContext","useNavigate","AccountContext","Auth","jsx","_jsx","jsxs","_jsxs","User_login","_useState","_useState2","_slicedToArray","email","setEmail","_useState3","_useState4","password","setPassword","navigate","_useContext","authenticate","setAuthenticated","window","fbAsyncInit","FB","init","appId","cookie","xfbml","version","AppEvents","logPageView","getLoginStatus","response","statusChangeCallback","d","s","id","js","fjs","getElementsByTagName","getElementById","createElement","src","parentNode","insertBefore","document","getUserInfo","console","log","api","fields","appsecret_proof","process","env","PASS_PHRASE","name","authResponse","getAuthResponse","accessToken","expiresIn","first_name","last_name","gender","client_id","client_secret","FACEBOOK_APP_SECRET","grant_type","fb_exchange_token","res","error","access_token","currentTimestamp","Date","now","computedExpiresAt","federatedSignIn","token","expires_at","given_name","family_name","picture","email_verified","then","data","catch","err","status","checkLoginState","onSubmit","event","preventDefault","children","htmlFor","value","onChange","target","type","onClick"],"sources":["/Users/ericli/Desktop/pill2/src/components/User_login.jsx"],"sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { AccountContext } from \"./User_Account.jsx\";\nimport { Auth } from \"aws-amplify\";\n\nconst User_login = () => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const navigate = useNavigate();\n  const { authenticate, setAuthenticated } = useContext(AccountContext);\n\n  useEffect(() => {\n    window.fbAsyncInit = function () {\n      window.FB.init({\n        appId: \"730655258288890\",\n        cookie: true,\n        xfbml: true,\n        version: \"v15.0\",\n      });\n\n      window.FB.AppEvents.logPageView();\n\n      window.FB.getLoginStatus(function (response) {\n        statusChangeCallback(response);\n      });\n    };\n\n    (function (d, s, id) {\n      var js,\n        fjs = d.getElementsByTagName(s)[0];\n      if (d.getElementById(id)) return;\n      js = d.createElement(s);\n      js.id = id;\n      js.src = \"https://connect.facebook.net/en_US/sdk.js\";\n      fjs.parentNode.insertBefore(js, fjs);\n    })(document, \"script\", \"facebook-jssdk\");\n  }, []);\n\n  const getUserInfo = () => {\n    console.log(\"Getting user info\");\n    window.FB.api(\n      \"/me\",\n      {\n        fields: \"name,email\",\n        appsecret_proof: process.env.PASS_PHRASE,\n      },\n      function (response) {\n        console.log(\"User info response:\", response); // Added logging here\n        console.log(\"Successful login for: \" + response.name);\n\n        const authResponse = window.FB.getAuthResponse();\n        let { accessToken, expiresIn } = authResponse;\n\n        if (!accessToken || !expiresIn) {\n          console.log(\"Access token or expiration time is missing.\");\n          return;\n        }\n\n        console.log(\"Facebook Access Token: \", accessToken);\n\n        const { email, first_name, last_name, gender } = response;\n\n        window.FB.api(\n          \"/oauth/access_token\",\n          {\n            client_id: \"730655258288890\",\n            client_secret: process.env.FACEBOOK_APP_SECRET,\n            grant_type: \"fb_exchange_token\",\n            fb_exchange_token: accessToken,\n          },\n          function (res) {\n            if (!res || res.error) {\n              console.log(\n                \"Failed to extend access token lifespan: \",\n                res.error\n              );\n            } else {\n              accessToken = res.access_token;\n              expiresIn = 60 * 60 * 24 * 60;\n\n              const currentTimestamp = Date.now();\n              const computedExpiresAt = expiresIn * 1000 + currentTimestamp;\n\n              if (!accessToken || !computedExpiresAt) {\n                console.log(\n                  \"Access token or computed expires time is missing.\"\n                );\n                return;\n              }\n\n              Auth.federatedSignIn(\n                \"facebook\",\n                {\n                  token: accessToken,\n                  expires_at: computedExpiresAt,\n                },\n                {\n                  given_name: first_name,\n                  family_name: last_name,\n                  email: email,\n                  gender: gender,\n                  picture: \"\",\n                  email_verified: true,\n                }\n              )\n                .then((data) => {\n                  console.log(\"Successful federated sign-in:\", data);\n                  setAuthenticated(true);\n                  navigate(\"/User_dashboard\");\n                })\n                .catch((err) => {\n                  console.log(\n                    \"Failed to login\",\n                    err || \"No error message provided\"\n                  );\n                });\n            }\n          }\n        );\n      }\n    );\n  };\n\n  const statusChangeCallback = (response) => {\n    console.log(\"Status Change Callback Response:\", response); // Added logging here\n    if (response.status === \"connected\") {\n      getUserInfo();\n    } else {\n      console.log(\"User cancelled login or did not fully authorize.\");\n    }\n  };\n\n  const checkLoginState = () => {\n    console.log(\"Checking login state\"); // Added logging here\n    window.FB.getLoginStatus(function (response) {\n      console.log(\"Got login status response\", response); // Added logging here\n      statusChangeCallback(response);\n    });\n  };\n\n  const onSubmit = (event) => {\n    event.preventDefault();\n\n    authenticate(email, password)\n      .then((data) => {\n        setAuthenticated(true);\n        navigate(\"/User_dashboard\");\n      })\n      .catch((err) => {\n        console.log(\"Failed to login\", err || \"No error message provided 1\");\n      });\n  };\n\n  return (\n    <div>\n      <form onSubmit={onSubmit}>\n        <label htmlFor=\"email\">Email</label>\n        <input\n          value={email}\n          onChange={(event) => setEmail(event.target.value)}\n        ></input>\n        <label htmlFor=\"password\">Password</label>\n        <input\n          value={password}\n          onChange={(event) => setPassword(event.target.value)}\n        ></input>\n        <button type=\"submit\">Login</button>\n      </form>\n      {/* <div\n        className=\"fb-login-button\"\n        data-width=\"\"\n        data-size=\"large\"\n        data-button-type=\"continue_with\"\n        data-layout=\"default\"\n        data-auto-logout-link=\"false\"\n        data-use-continue-as=\"true\"\n        onClick={checkLoginState}\n      ></div> */}\n      <button onClick={checkLoginState}> Hi </button>\n    </div>\n  );\n};\n\nexport default User_login;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}