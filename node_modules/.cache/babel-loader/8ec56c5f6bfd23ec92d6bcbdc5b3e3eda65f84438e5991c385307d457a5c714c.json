{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { toHex } from \"@aws-sdk/util-hex-encoding\";\nimport { toUint8Array } from \"@aws-sdk/util-utf8\";\nimport { KEY_TYPE_IDENTIFIER, MAX_CACHE_SIZE } from \"./constants\";\nvar signingKeyCache = {};\nvar cacheQueue = [];\nexport var createScope = function createScope(shortDate, region, service) {\n  return \"\".concat(shortDate, \"/\").concat(region, \"/\").concat(service, \"/\").concat(KEY_TYPE_IDENTIFIER);\n};\nexport var getSigningKey = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(sha256Constructor, credentials, shortDate, region, service) {\n    var credsHash, cacheKey, key, _i, _arr, signable;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return hmac(sha256Constructor, credentials.secretAccessKey, credentials.accessKeyId);\n        case 2:\n          credsHash = _context.sent;\n          cacheKey = \"\".concat(shortDate, \":\").concat(region, \":\").concat(service, \":\").concat(toHex(credsHash), \":\").concat(credentials.sessionToken);\n          if (!(cacheKey in signingKeyCache)) {\n            _context.next = 6;\n            break;\n          }\n          return _context.abrupt(\"return\", signingKeyCache[cacheKey]);\n        case 6:\n          cacheQueue.push(cacheKey);\n          while (cacheQueue.length > MAX_CACHE_SIZE) {\n            delete signingKeyCache[cacheQueue.shift()];\n          }\n          key = \"AWS4\".concat(credentials.secretAccessKey);\n          _i = 0, _arr = [shortDate, region, service, KEY_TYPE_IDENTIFIER];\n        case 10:\n          if (!(_i < _arr.length)) {\n            _context.next = 18;\n            break;\n          }\n          signable = _arr[_i];\n          _context.next = 14;\n          return hmac(sha256Constructor, key, signable);\n        case 14:\n          key = _context.sent;\n        case 15:\n          _i++;\n          _context.next = 10;\n          break;\n        case 18:\n          return _context.abrupt(\"return\", signingKeyCache[cacheKey] = key);\n        case 19:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function getSigningKey(_x, _x2, _x3, _x4, _x5) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var clearCredentialCache = function clearCredentialCache() {\n  cacheQueue.length = 0;\n  Object.keys(signingKeyCache).forEach(function (cacheKey) {\n    delete signingKeyCache[cacheKey];\n  });\n};\nvar hmac = function hmac(ctor, secret, data) {\n  var hash = new ctor(secret);\n  hash.update(toUint8Array(data));\n  return hash.digest();\n};","map":{"version":3,"names":["toHex","toUint8Array","KEY_TYPE_IDENTIFIER","MAX_CACHE_SIZE","signingKeyCache","cacheQueue","createScope","shortDate","region","service","concat","getSigningKey","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","sha256Constructor","credentials","credsHash","cacheKey","key","_i","_arr","signable","wrap","_callee$","_context","prev","next","hmac","secretAccessKey","accessKeyId","sent","sessionToken","abrupt","push","length","shift","stop","_x","_x2","_x3","_x4","_x5","apply","arguments","clearCredentialCache","Object","keys","forEach","ctor","secret","data","hash","update","digest"],"sources":["/Users/ericli/Desktop/pill2/node_modules/@aws-sdk/client-s3/node_modules/@aws-sdk/signature-v4/dist-es/credentialDerivation.js"],"sourcesContent":["import { toHex } from \"@aws-sdk/util-hex-encoding\";\nimport { toUint8Array } from \"@aws-sdk/util-utf8\";\nimport { KEY_TYPE_IDENTIFIER, MAX_CACHE_SIZE } from \"./constants\";\nconst signingKeyCache = {};\nconst cacheQueue = [];\nexport const createScope = (shortDate, region, service) => `${shortDate}/${region}/${service}/${KEY_TYPE_IDENTIFIER}`;\nexport const getSigningKey = async (sha256Constructor, credentials, shortDate, region, service) => {\n    const credsHash = await hmac(sha256Constructor, credentials.secretAccessKey, credentials.accessKeyId);\n    const cacheKey = `${shortDate}:${region}:${service}:${toHex(credsHash)}:${credentials.sessionToken}`;\n    if (cacheKey in signingKeyCache) {\n        return signingKeyCache[cacheKey];\n    }\n    cacheQueue.push(cacheKey);\n    while (cacheQueue.length > MAX_CACHE_SIZE) {\n        delete signingKeyCache[cacheQueue.shift()];\n    }\n    let key = `AWS4${credentials.secretAccessKey}`;\n    for (const signable of [shortDate, region, service, KEY_TYPE_IDENTIFIER]) {\n        key = await hmac(sha256Constructor, key, signable);\n    }\n    return (signingKeyCache[cacheKey] = key);\n};\nexport const clearCredentialCache = () => {\n    cacheQueue.length = 0;\n    Object.keys(signingKeyCache).forEach((cacheKey) => {\n        delete signingKeyCache[cacheKey];\n    });\n};\nconst hmac = (ctor, secret, data) => {\n    const hash = new ctor(secret);\n    hash.update(toUint8Array(data));\n    return hash.digest();\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}