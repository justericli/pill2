{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/ericli/Desktop/pill2/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{createContext,useState}from\"react\";import Pool from\"../Userpool.js\";import{CognitoUser,AuthenticationDetails}from\"amazon-cognito-identity-js\";import{jsx as _jsx}from\"react/jsx-runtime\";var AccountContext=/*#__PURE__*/createContext();var Account=function Account(props){var children=props.children;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),authenticated=_useState2[0],setAuthenticated=_useState2[1];var getSession=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return new Promise(function(resolve,reject){var user=Pool.getCurrentUser();if(user){user.getSession(function(err,session){if(err){reject();}else{setAuthenticated(true);resolve(session);}});}else{reject();}});case 2:return _context.abrupt(\"return\",_context.sent);case 3:case\"end\":return _context.stop();}},_callee);}));return function getSession(){return _ref.apply(this,arguments);};}();var authenticate=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(Username,Password){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return new Promise(function(resolve,reject){var user=new CognitoUser({Username:Username,Pool:Pool});var authDetails=new AuthenticationDetails({Username:Username,Password:Password});user.authenticateUser(authDetails,{onSuccess:function onSuccess(data){console.log(\"onSuccess: \",data);setAuthenticated(function(prevState){if(!prevState){localStorage.setItem(\"authenticated\",true);}return true;});resolve(data);},onFailure:function onFailure(err){console.error(\"onFailure: \",err);reject(err);},newPasswordRequired:function newPasswordRequired(data){console.log(\"newPasswordRequired: \",data);resolve(data);}});});case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}},_callee2);}));return function authenticate(_x,_x2){return _ref2.apply(this,arguments);};}();var logout=function logout(){var user=Pool.getCurrentUser();if(user){user.signOut();setAuthenticated(false);localStorage.removeItem(\"authenticated\");}};return/*#__PURE__*/_jsx(AccountContext.Provider,{value:{authenticate:authenticate,getSession:getSession,logout:logout,authenticated:authenticated,setAuthenticated:setAuthenticated},children:children});};export default Account;export{AccountContext};","map":{"version":3,"names":["React","createContext","useState","Pool","CognitoUser","AuthenticationDetails","jsx","_jsx","AccountContext","Account","props","children","_useState","_useState2","_slicedToArray","authenticated","setAuthenticated","getSession","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","Promise","resolve","reject","user","getCurrentUser","err","session","abrupt","sent","stop","apply","arguments","authenticate","_ref2","_callee2","Username","Password","_callee2$","_context2","authDetails","authenticateUser","onSuccess","data","console","log","prevState","localStorage","setItem","onFailure","error","newPasswordRequired","_x","_x2","logout","signOut","removeItem","Provider","value"],"sources":["/Users/ericli/Desktop/pill2/src/components/Account.jsx"],"sourcesContent":["import React, { createContext, useState } from \"react\";\nimport Pool from \"../Userpool.js\";\nimport { CognitoUser, AuthenticationDetails } from \"amazon-cognito-identity-js\";\n\nconst AccountContext = createContext();\n\nconst Account = (props) => {\n  const { children } = props;\n  const [authenticated, setAuthenticated] = useState(false);\n  const getSession = async () => {\n    return await new Promise((resolve, reject) => {\n      const user = Pool.getCurrentUser();\n      if (user) {\n        user.getSession((err, session) => {\n          if (err) {\n            reject();\n          } else {\n            setAuthenticated(true);\n            resolve(session);\n          }\n        });\n      } else {\n        reject();\n      }\n    });\n  };\n\n  const authenticate = async (Username, Password) => {\n    return await new Promise((resolve, reject) => {\n      const user = new CognitoUser({ Username, Pool });\n\n      const authDetails = new AuthenticationDetails({ Username, Password });\n\n      user.authenticateUser(authDetails, {\n        onSuccess: (data) => {\n          console.log(\"onSuccess: \", data);\n          setAuthenticated((prevState) => {\n            if (!prevState) {\n              localStorage.setItem(\"authenticated\", true);\n            }\n            return true;\n          });\n          resolve(data);\n        },\n        onFailure: (err) => {\n          console.error(\"onFailure: \", err);\n          reject(err);\n        },\n        newPasswordRequired: (data) => {\n          console.log(\"newPasswordRequired: \", data);\n          resolve(data);\n        },\n      });\n    });\n  };\n\n  const logout = () => {\n    const user = Pool.getCurrentUser();\n    if (user) {\n      user.signOut();\n      setAuthenticated(false);\n      localStorage.removeItem(\"authenticated\");\n    }\n  };\n\n  return (\n    <AccountContext.Provider\n      value={{\n        authenticate,\n        getSession,\n        logout,\n        authenticated,\n        setAuthenticated,\n      }}\n    >\n      {children}\n    </AccountContext.Provider>\n  );\n};\n\nexport default Account;\nexport { AccountContext };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}