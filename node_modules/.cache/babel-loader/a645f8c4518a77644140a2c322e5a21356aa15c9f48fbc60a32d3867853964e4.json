{"ast":null,"code":"import { __awaiter, __extends, __generator, __read, __rest, __spread } from \"tslib\";\nimport Observable from 'zen-observable-ts';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nimport { MqttOverWSProvider } from './MqttOverWSProvider';\nvar logger = new Logger('AWSAppSyncProvider');\n/**\n * @deprecated Unused, all usecases have migrated to AWSAppSyncRealtimeProvider\n */\nvar AWSAppSyncProvider = /** @class */function (_super) {\n  __extends(AWSAppSyncProvider, _super);\n  function AWSAppSyncProvider() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this._topicClient = new Map();\n    _this._topicAlias = new Map();\n    return _this;\n  }\n  Object.defineProperty(AWSAppSyncProvider.prototype, \"endpoint\", {\n    get: function () {\n      throw new Error('Not supported');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  AWSAppSyncProvider.prototype.getProviderName = function () {\n    return 'AWSAppSyncProvider';\n  };\n  AWSAppSyncProvider.prototype.publish = function (topics, msg, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        throw new Error('Operation not supported');\n      });\n    });\n  };\n  AWSAppSyncProvider.prototype._cleanUp = function (clientId) {\n    var _this = this;\n    var topicsForClient = Array.from(this._topicClient.entries()).filter(function (_a) {\n      var _b = __read(_a, 2),\n        c = _b[1];\n      return c.clientId === clientId;\n    }).map(function (_a) {\n      var _b = __read(_a, 1),\n        t = _b[0];\n      return t;\n    });\n    topicsForClient.forEach(function (t) {\n      return _this._cleanUpForTopic(t);\n    });\n  };\n  AWSAppSyncProvider.prototype._cleanUpForTopic = function (topic) {\n    this._topicClient.delete(topic);\n    this._topicAlias.delete(topic);\n  };\n  AWSAppSyncProvider.prototype.onDisconnect = function (_a) {\n    var _this = this;\n    var clientId = _a.clientId,\n      errorCode = _a.errorCode,\n      args = __rest(_a, [\"clientId\", \"errorCode\"]);\n    if (errorCode !== 0) {\n      var topicsForClient = Array.from(this._topicClient.entries()).filter(function (_a) {\n        var _b = __read(_a, 2),\n          c = _b[1];\n        return c.clientId === clientId;\n      }).map(function (_a) {\n        var _b = __read(_a, 1),\n          t = _b[0];\n        return t;\n      });\n      topicsForClient.forEach(function (topic) {\n        if (_this._topicObservers.has(topic)) {\n          _this._topicObservers.get(topic).forEach(function (obs) {\n            if (!obs.closed) {\n              obs.error(args);\n            }\n          });\n          _this._topicObservers.delete(topic);\n        }\n      });\n      this._cleanUp(clientId);\n    }\n  };\n  AWSAppSyncProvider.prototype.disconnect = function (clientId) {\n    return __awaiter(this, void 0, void 0, function () {\n      var client;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.clientsQueue.get(clientId, function () {\n              return null;\n            })];\n          case 1:\n            client = _a.sent();\n            return [4 /*yield*/, _super.prototype.disconnect.call(this, clientId)];\n          case 2:\n            _a.sent();\n            this._cleanUp(clientId);\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  AWSAppSyncProvider.prototype.subscribe = function (topics, options) {\n    var _this = this;\n    if (options === void 0) {\n      options = {};\n    }\n    var result = new Observable(function (observer) {\n      var targetTopics = [].concat(topics);\n      logger.debug('Subscribing to topic(s)', targetTopics.join(','));\n      (function () {\n        return __awaiter(_this, void 0, void 0, function () {\n          var _a, mqttConnections, newSubscriptions, newAliases, map;\n          var _this = this;\n          return __generator(this, function (_b) {\n            switch (_b.label) {\n              case 0:\n                // Add these topics to map\n                targetTopics.forEach(function (t) {\n                  if (!_this._topicObservers.has(t)) {\n                    _this._topicObservers.set(t, new Set());\n                  }\n                  _this._topicObservers.get(t).add(observer);\n                });\n                _a = options.mqttConnections, mqttConnections = _a === void 0 ? [] : _a, newSubscriptions = options.newSubscriptions;\n                newAliases = Object.entries(newSubscriptions).map(function (_a) {\n                  var _b = __read(_a, 2),\n                    alias = _b[0],\n                    v = _b[1];\n                  return [v.topic, alias];\n                });\n                // Merge new aliases with old ones\n                this._topicAlias = new Map(__spread(Array.from(this._topicAlias.entries()), newAliases));\n                map = Object.entries(targetTopics.reduce(function (acc, elem) {\n                  var connectionInfoForTopic = mqttConnections.find(function (c) {\n                    return c.topics.indexOf(elem) > -1;\n                  });\n                  if (connectionInfoForTopic) {\n                    var clientId = connectionInfoForTopic.client,\n                      url = connectionInfoForTopic.url;\n                    if (!acc[clientId]) {\n                      acc[clientId] = {\n                        url: url,\n                        topics: new Set()\n                      };\n                    }\n                    acc[clientId].topics.add(elem);\n                  }\n                  return acc;\n                }, {}));\n                // reconnect everything we have in the map\n                return [4 /*yield*/, Promise.all(map.map(function (_a) {\n                  var _b = __read(_a, 2),\n                    clientId = _b[0],\n                    _c = _b[1],\n                    url = _c.url,\n                    topics = _c.topics;\n                  return __awaiter(_this, void 0, void 0, function () {\n                    var client, err_1;\n                    var _this = this;\n                    return __generator(this, function (_d) {\n                      switch (_d.label) {\n                        case 0:\n                          client = null;\n                          _d.label = 1;\n                        case 1:\n                          _d.trys.push([1, 3,, 4]);\n                          return [4 /*yield*/, this.connect(clientId, {\n                            clientId: clientId,\n                            url: url\n                          })];\n                        case 2:\n                          client = _d.sent();\n                          return [3 /*break*/, 4];\n                        case 3:\n                          err_1 = _d.sent();\n                          observer.error({\n                            message: 'Failed to connect',\n                            error: err_1\n                          });\n                          observer.complete();\n                          return [2 /*return*/, undefined];\n                        case 4:\n                          // subscribe to all topics for this client\n                          // store topic-client mapping\n                          topics.forEach(function (topic) {\n                            if (client.isConnected()) {\n                              client.subscribe(topic);\n                              _this._topicClient.set(topic, client);\n                            }\n                          });\n                          return [2 /*return*/, client];\n                      }\n                    });\n                  });\n                }))];\n              case 1:\n                // reconnect everything we have in the map\n                _b.sent();\n                return [2 /*return*/];\n            }\n          });\n        });\n      })();\n\n      return function () {\n        logger.debug('Unsubscribing from topic(s)', targetTopics.join(','));\n        targetTopics.forEach(function (t) {\n          var client = _this._topicClient.get(t);\n          if (client && client.isConnected()) {\n            client.unsubscribe(t);\n            _this._topicClient.delete(t);\n            if (!Array.from(_this._topicClient.values()).some(function (c) {\n              return c === client;\n            })) {\n              _this.disconnect(client.clientId);\n            }\n          }\n          _this._topicObservers.delete(t);\n        });\n      };\n    });\n    return Observable.from(result).map(function (value) {\n      var topic = _this.getTopicForValue(value);\n      var alias = _this._topicAlias.get(topic);\n      value.data = Object.entries(value.data).reduce(function (obj, _a) {\n        var _b = __read(_a, 2),\n          origKey = _b[0],\n          val = _b[1];\n        return obj[alias || origKey] = val, obj;\n      }, {});\n      return value;\n    });\n  };\n  return AWSAppSyncProvider;\n}(MqttOverWSProvider);\nexport { AWSAppSyncProvider };","map":{"version":3,"names":["Observable","ConsoleLogger","Logger","MqttOverWSProvider","logger","AWSAppSyncProvider","_super","__extends","_this","apply","arguments","_topicClient","Map","_topicAlias","Object","defineProperty","prototype","get","Error","getProviderName","publish","topics","msg","options","_cleanUp","clientId","topicsForClient","Array","from","entries","filter","_a","_b","__read","c","map","t","forEach","_cleanUpForTopic","topic","delete","onDisconnect","errorCode","args","__rest","_topicObservers","has","obs","closed","error","disconnect","clientsQueue","client","sent","call","subscribe","result","observer","targetTopics","concat","debug","join","__awaiter","set","Set","add","mqttConnections","newSubscriptions","newAliases","alias","v","__spread","reduce","acc","elem","connectionInfoForTopic","find","indexOf","url","Promise","all","_c","connect","_d","message","err_1","complete","undefined","isConnected","unsubscribe","values","some","value","getTopicForValue","data","obj","origKey","val"],"sources":["/Users/ericli/node_modules/@aws-amplify/pubsub/src/Providers/AWSAppSyncProvider.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { Client } from 'paho-mqtt';\nimport Observable from 'zen-observable-ts';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\n\nimport { MqttOverWSProvider } from './MqttOverWSProvider';\n\nconst logger = new Logger('AWSAppSyncProvider');\n\n/**\n * @deprecated Unused, all usecases have migrated to AWSAppSyncRealtimeProvider\n */\nexport class AWSAppSyncProvider extends MqttOverWSProvider {\n\tprotected get endpoint() {\n\t\tthrow new Error('Not supported');\n\t}\n\n\tgetProviderName() {\n\t\treturn 'AWSAppSyncProvider';\n\t}\n\n\tpublic async publish(topics: string[] | string, msg: any, options?: any) {\n\t\tthrow new Error('Operation not supported');\n\t}\n\n\tprivate _cleanUp(clientId: string) {\n\t\tconst topicsForClient = Array.from(this._topicClient.entries())\n\t\t\t.filter(([, c]) => c.clientId === clientId)\n\t\t\t.map(([t]) => t);\n\n\t\ttopicsForClient.forEach(t => this._cleanUpForTopic(t));\n\t}\n\n\tprivate _cleanUpForTopic(topic) {\n\t\tthis._topicClient.delete(topic);\n\t\tthis._topicAlias.delete(topic);\n\t}\n\n\tpublic onDisconnect({ clientId, errorCode, ...args }) {\n\t\tif (errorCode !== 0) {\n\t\t\tconst topicsForClient = Array.from(this._topicClient.entries())\n\t\t\t\t.filter(([, c]) => c.clientId === clientId)\n\t\t\t\t.map(([t]) => t);\n\n\t\t\ttopicsForClient.forEach(topic => {\n\t\t\t\tif (this._topicObservers.has(topic)) {\n\t\t\t\t\tthis._topicObservers.get(topic).forEach(obs => {\n\t\t\t\t\t\tif (!obs.closed) {\n\t\t\t\t\t\t\tobs.error(args);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._topicObservers.delete(topic);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._cleanUp(clientId);\n\t\t}\n\t}\n\n\tprivate _topicClient: Map<string, Client> = new Map();\n\n\tprivate _topicAlias: Map<string, string> = new Map();\n\n\tprotected async disconnect(clientId: string): Promise<void> {\n\t\tconst client = await this.clientsQueue.get(clientId, () => null);\n\n\t\tawait super.disconnect(clientId);\n\n\t\tthis._cleanUp(clientId);\n\t}\n\n\tsubscribe(topics: string[] | string, options: any = {}): Observable<any> {\n\t\tconst result = new Observable<any>(observer => {\n\t\t\tconst targetTopics = ([] as string[]).concat(topics);\n\t\t\tlogger.debug('Subscribing to topic(s)', targetTopics.join(','));\n\n\t\t\t(async () => {\n\t\t\t\t// Add these topics to map\n\t\t\t\ttargetTopics.forEach(t => {\n\t\t\t\t\tif (!this._topicObservers.has(t)) {\n\t\t\t\t\t\tthis._topicObservers.set(t, new Set());\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._topicObservers.get(t).add(observer);\n\t\t\t\t});\n\n\t\t\t\tconst { mqttConnections = [], newSubscriptions } = options;\n\n\t\t\t\t// creates a map of {\"topic\": \"alias\"}\n\t\t\t\tconst newAliases = Object.entries(newSubscriptions).map(\n\t\t\t\t\t([alias, v]: [string, { topic: string }]) => [v.topic, alias]\n\t\t\t\t);\n\n\t\t\t\t// Merge new aliases with old ones\n\t\t\t\tthis._topicAlias = new Map([\n\t\t\t\t\t...Array.from(this._topicAlias.entries()),\n\t\t\t\t\t...(newAliases as [string, string][]),\n\t\t\t\t]);\n\n\t\t\t\t// group by urls\n\t\t\t\tconst map: [string, { url: string; topics: Set<string> }][] =\n\t\t\t\t\tObject.entries(\n\t\t\t\t\t\ttargetTopics.reduce((acc, elem) => {\n\t\t\t\t\t\t\tconst connectionInfoForTopic = mqttConnections.find(\n\t\t\t\t\t\t\t\tc => c.topics.indexOf(elem) > -1\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (connectionInfoForTopic) {\n\t\t\t\t\t\t\t\tconst { client: clientId, url } = connectionInfoForTopic;\n\n\t\t\t\t\t\t\t\tif (!acc[clientId]) {\n\t\t\t\t\t\t\t\t\tacc[clientId] = {\n\t\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\t\ttopics: new Set(),\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tacc[clientId].topics.add(elem);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t}, {})\n\t\t\t\t\t);\n\n\t\t\t\t// reconnect everything we have in the map\n\t\t\t\tawait Promise.all(\n\t\t\t\t\tmap.map(async ([clientId, { url, topics }]) => {\n\t\t\t\t\t\t// connect to new client\n\t\t\t\t\t\tlet client = null;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tclient = await this.connect(clientId, {\n\t\t\t\t\t\t\t\tclientId,\n\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tobserver.error({ message: 'Failed to connect', error: err });\n\t\t\t\t\t\t\tobserver.complete();\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// subscribe to all topics for this client\n\t\t\t\t\t\t// store topic-client mapping\n\t\t\t\t\t\ttopics.forEach(topic => {\n\t\t\t\t\t\t\tif (client.isConnected()) {\n\t\t\t\t\t\t\t\tclient.subscribe(topic);\n\n\t\t\t\t\t\t\t\tthis._topicClient.set(topic, client);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn client;\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t})();\n\n\t\t\treturn () => {\n\t\t\t\tlogger.debug('Unsubscribing from topic(s)', targetTopics.join(','));\n\n\t\t\t\ttargetTopics.forEach(t => {\n\t\t\t\t\tconst client = this._topicClient.get(t);\n\n\t\t\t\t\tif (client && client.isConnected()) {\n\t\t\t\t\t\tclient.unsubscribe(t);\n\t\t\t\t\t\tthis._topicClient.delete(t);\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!Array.from(this._topicClient.values()).some(c => c === client)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis.disconnect(client.clientId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._topicObservers.delete(t);\n\t\t\t\t});\n\t\t\t};\n\t\t});\n\n\t\treturn Observable.from(result).map(value => {\n\t\t\tconst topic = this.getTopicForValue(value);\n\t\t\tconst alias = this._topicAlias.get(topic);\n\n\t\t\tvalue.data = Object.entries(value.data).reduce(\n\t\t\t\t(obj, [origKey, val]) => (\n\t\t\t\t\t(obj[(alias || origKey) as string] = val), obj\n\t\t\t\t),\n\t\t\t\t{}\n\t\t\t);\n\n\t\t\treturn value;\n\t\t});\n\t}\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}